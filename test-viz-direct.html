<!DOCTYPE html>
<html>
<head>
    <title>Direct Visualization Test</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { background: #1a1a1a; color: white; font-family: Arial; padding: 20px; }
        button { background: #4CAF50; color: white; padding: 10px 20px; border: none; cursor: pointer; margin: 10px; }
        #chart-container { width: 600px; height: 400px; margin: 20px auto; }
    </style>
</head>
<body>
    <h1>Direct Visualization Test</h1>
    <p>Click the button to test visualization without AI:</p>
    
    <button onclick="testVisualization()">Test Bar Chart</button>
    <button onclick="testExecuteAnalysis()">Test Execute Analysis</button>
    
    <div id="result"></div>
    <div id="chart-container">
        <canvas id="myChart"></canvas>
    </div>
    
    <script>
    async function testExecuteAnalysis() {
        const response = await fetch('http://localhost:5001/api/tools/execute_analysis', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                code: `
conn = get_db_connection()
df = pd.read_sql("SELECT group_name, AVG(roi) as avg_roi FROM calls GROUP BY group_name HAVING COUNT(*) > 10 ORDER BY avg_roi DESC LIMIT 10", conn)
result = {'labels': df['group_name'].tolist(), 'values': df['avg_roi'].tolist()}
                `,
                visualization_type: 'bar',
                title: 'Top 10 Groups by ROI'
            })
        });
        
        const data = await response.json();
        document.getElementById('result').innerHTML = '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
        
        if (data.success && data.visualization) {
            createChart(data.visualization.data);
        }
    }
    
    function createChart(data) {
        const ctx = document.getElementById('myChart').getContext('2d');
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: data.labels,
                datasets: [{
                    label: 'Average ROI',
                    data: data.values,
                    backgroundColor: 'rgba(75, 192, 192, 0.6)'
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { labels: { color: 'white' } },
                    title: { display: true, text: 'Direct Test', color: 'white' }
                },
                scales: {
                    x: { ticks: { color: 'white' } },
                    y: { ticks: { color: 'white' } }
                }
            }
        });
    }
    
    function testVisualization() {
        // Dummy data
        const data = {
            labels: ['Group A', 'Group B', 'Group C', 'Group D', 'Group E'],
            values: [12, 19, 3, 5, 2]
        };
        createChart(data);
    }
    </script>
</body>
</html>